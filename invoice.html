<!doctype html>
<html>
<head>
    <title>Demo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="css/select2.css" rel="stylesheet"/>
    <link href="css/service2.css" rel="stylesheet" type="text/css">
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/bootstrap-3-3-7.min.js"></script>
    <script src="js/select2.js"></script>

    <script>
		
		function addNewLine(){
		
                var table = $("#invoiceTable")[0];

                var existingRow = table.rows[1];
                var newRow = table.insertRow(2);
                for (var i = 0; i < existingRow.cells.length; i++) {
                    var cell = existingRow.cells[i];
                    var newCell = newRow.insertCell();
					var copied = $(cell).children().first().clone();
                    copied.appendTo(newCell);
                    if(copied.hasClass("select2")){
					 copied.select2();
					}
                }
            return newRow;
		}
		function populateInvoice(invoice){			
			console.log("invoice",invoice);
			invoice.items.forEach(function(item){
			console.log(item);
			var line = addNewLine();
			;				
				$(line.cells[0]).children().first().select2().val(item.partNumber).trigger('change');
				$(line.cells[1]).children().first().select2().val(item.description).trigger('change');
				$(line.cells[2]).children().first().select2().val(item.qty).trigger('change');
				$("input", line.cells[3]).val(item.price);
				$("input", line.cells[4]).val(item.labour);	
				$("#vat").val(item.vat);
				$("#discount").val(item.discount);
				$("#total").val(item.total);
			});
			
		}
		
		function loadQuoteFromServer(id) {
      console.log("pretending to read quote", id, "from server");
      var quote = {
        person: {
          firstName  : "Johannes",
          lastName  : "Loper",
          idType  : "Drivers License"
        },
        car: {

        },
        invoice: {
          date: new Date(2016,7,6),
          items: [
            {
              partNumber: "Z555",
              description: "123",
              qty: 4,
              price: 1.5,
              labour: 150.50,
			  vat: 130,
			  discount: 30,
			  total: 1000
			  
            }, {
              partNumber: "X777",
              description: "122",
              qty: 2,
              price: 3000,
              labour: 350.50,
			  vat: 110,
			  discount: 10,
			  total: 1000
            }
          ],
          vat: 297.23,
          discount: 97.23,
          total: 2999.99
        }
      };

      return quote;
    }

        $(document).ready(function () {

            $("#qty").select2();
            $("#partnumber").select2();
            $("#discription").select2();

			var searchString = location.search;
      		if(searchString) {
        		var id = searchString.split("=")[1];
				var quote = loadQuoteFromServer(id);
        		populateInvoice(quote.invoice);
      		}

            console.log("hello");
            $("#addNewLine").on("click", addNewLine);
        });

    </script>
    </head>

    <body>
<ul class="nav nav-pills nav-justified">
      <li class="active"><a href="search.html">Search</a></li>
      <li><a href="invoice.html">Invoice</a></li>
      <li><a href="person.html">Person</a></li>
      <li><a href="car.html">Car</a></li>
    </ul>
<table width="100%" border="1">
      <tbody>
    <tr>
          <td width="93%">&nbsp;</td>
          <td width="7%" height="23"><input type="submit" name="Print" id="Print" value="Print Invoice"></td>
        </tr>
  </tbody>
    </table>
<table width="100%" border="1">
      <tbody>
    <tr>
          <td width="84%">&nbsp;</td>
          <td width="16%"><label for="datetime">Date:</label>
        <input type="datetime" name="datetime" id="datetime"></td>
        </tr>
  </tbody>
    </table>
<table width="100%" border="1" id="invoiceTable">
      <tbody>
    <tr>
          <td width="17%" style="text-align: center">Part Number</td>
          <td width="44%" style="text-align: center">Discription</td>
          <td width="10%" style="text-align: center">Qty</td>
          <td width="15%" style="text-align: center">Unit Price</td>
          <td width="14%" style="text-align: center">Labour Cost</td>
        </tr>
    <tr>
          <td><select class="select2" name="partnumber" style="width: 200px;">
              <option value="X123">X123</option>
              <option value="X777">X777</option>
              <option value="Z555">Z555</option>
            </select></td>
          <td><select class="select2" name="discription" style="width: 530px;">
              <option value="123">Replace Brakes</option>
              <option value="122">Replace Brake Fluid</option>
              <option value="121">New Battery</option>
              <option value="120">Replace Pistons</option>
            </select></td>
          <td>
            <select class="select2" name="qty" style="width: 100px;">
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
				<option value="8">8</option>
				<option value="9">9</option>
				<option value="10">10</option>
          </select>
            </span></td>
          <td><input type="text" name="price"></td>
          <td><input type="text" name="labour"></td>
        </tr>
    <tr>
          <td><input name="Add New Line" type="button" id="addNewLine" title="Add New Line" value="+">
        <input name="Delete Current Line" type="button" id="deleteLine" title="Delete Current Line" value="-"></td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
  </tbody>
    </table>
<table width="100%" border="1">
      <tbody>
    <tr>
          <td>&nbsp;</td>
          <td>VAT:
        
        <input type="number" id="vat"</td>
        </tr>
    <tr>
          <td>&nbsp;</td>
          <td>Discount: 
        <input type="number" id="discount"</td>
        </tr>
    <tr>
          <td width="85%">&nbsp;</td>
          <td width="15%"><label for="total">Total:</label>
        
        <input type="number" name="number" id="total"></td>
        </tr>
  </tbody>
    </table>
<table width="100%" border="1">
      <tbody>
    <tr>
          <td width="92%">&nbsp;</td>
          <td width="4%"><input name="Close" type="button" id="Close" title="Close" value="Close"></td>
          <td width="4%"><input name="Save" type="button" id="Save" title="Save" value="Save"></td>
        </tr>
  </tbody>
    </table>
</body>
</html>
